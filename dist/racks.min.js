(function(){"use strict";var t;module.exports=t=function(){function t(t,e){this.authObj=t,this.https_node=require("https"),this.url=require("url"),this.fs=require("fs"),this.authToken=!1,this.products={},null==this.authObj&&(this.authObj={}),this.verbosity=null==this.authObj.verbosity?0:this.authObj.verbosity,null==this.authObj.endpoint&&(this.authObj.endpoint="https://identity.api.rackspacecloud.com/v2.0"),this.test=null==this.authObj.test?!1:this.authObj.test,this.network=null==this.authObj.network?"public":this.authObj.network,"private"===this.network&&(this.network="internal"),this.clr={red:"[31m",blue:"[34m",green:"[32m",cyan:"[36m",gray:"[1;30m",reset:"[0m"},this.httpCodes={200:"OK",202:"Accepted",204:"No Content",400:"Compute Fault / Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not found",413:"Over API limits",415:"Bad Media Type",503:"Service Unavailable"},this.buildProducts(),null!=this.authObj.username&&null!=this.authObj.apiKey&&null!=e&&this.authenticate(this.authObj,e)}return t.prototype.log=function(){var t;return t=new Date,process.stdout.write(t.getMonth()+"/"+t.getDate()+" "+t.toTimeString().split(" ")[0]+" "),console.log.apply(this,arguments)},t.prototype.https=function(t,e){var r,n;return null==t.headers&&(t.headers={}),r=t.plaintext,delete t.plaintext,this.authToken&&(t.headers["X-Auth-Token"]=this.authToken),t.headers["Content-Type"]="application/json",null!=t.data&&("object"==typeof t.data&&(t.data=JSON.stringify(t.data)),t.headers["Content-Length"]=t.data.length),t.url=this.url.parse(t.url),t.host=t.url.host,t.path=t.url.path,delete t.url,1===this.verbosity?this.log(this.clr.cyan+t.method+this.clr.reset+":",t.path):this.verbosity>1&&this.log(this.clr.cyan+"Request"+this.clr.reset+":",t),this.test?this.mockApi(t,e):(n=this.https_node.request(t,function(n){return function(a){var s;return s="",a.setEncoding("utf8"),a.on("data",function(t){return s+=t}),a.on("end",function(){var t,u;if(r)u=0===s.length?[]:s.substr(0,s.length-1).split("\n");else try{u=JSON.parse(s)}catch(i){t=i,u=s}return n.verbosity>0&&n.verbosity<4?n.log(n.clr.green+"Reply"+n.clr.reset+":",a.statusCode,n.httpCodes[a.statusCode]):n.verbosity>3&&n.log(n.clr.green+"Reply"+n.clr.reset+":",u),e(u)}),a.on("error",function(e){return n.log(e,t)})}}(this)),null!=t.data&&n.write(t.data),n.end())},t.prototype.get=function(t,e){return this.https({method:"GET",url:t},e)},t.prototype.post=function(t,e,r){return this.https({method:"POST",url:t,data:e},r)},t.prototype["delete"]=function(t,e){return null==e&&(e=function(){return!1}),this.https({method:"DELETE",url:t},e)},t.prototype.put=function(t,e,r){return this.https({method:"PUT",url:t,data:e},r)},t.prototype.authenticate=function(t,e){return null==t.username||null==t.apiKey?e({error:"No username or apiKey provided to .authenticate()"}):this.post(t.endpoint+"/tokens",{auth:{"RAX-KSKEY:apiKeyCredentials":{username:t.username,apiKey:t.apiKey}}},function(t){return function(r){return null!=r.access?(t.authToken=r.access.token.id,t.access=r.access,t.error=!1,t.serviceCatalog=r.access.serviceCatalog,t.buildCatalog(t.serviceCatalog)):(t.log("Auth failed",r),t.error="Auth failed"),e(t)}}(this))},t.prototype.buildModel=function(t,e){var r,n;return n=this,null==t.model?e:(r=t.model(e),r._racksmeta={resource:t._racksmeta.name,product:t._racksmeta.product,target:function(){return function(){var e,n;return n=t._racksmeta.target(),e="","/"===n.substr(-1)&&(n=n.substr(0,n.length-1)),null!=r.id?e=r.id:null!=r.name&&(e=r.name),n+"/"+e}}(this)},r)},t.prototype.resourceRequest=function(t,e){return this.https({url:t._racksmeta.target(),plaintext:t._racksmeta.plaintext,method:"GET"},function(r){return function(n){var a,s;return a=t._racksmeta.name,null!=t._racksmeta.replyString&&(a=t._racksmeta.replyString),null!=n[a]?t.model?null!=n[a].push?(s=[],n[a].forEach(function(e){return s.push(r.buildModel(t,e))}),e(s)):e(r.buildModel(t,n[a])):e(n[a]):null!=t._racksmeta.plaintext?(s=[],n.forEach(function(e){return s.push(r.buildModel(t,e))}),e(s)):null!=e?e(n):void 0}}(this))},t.prototype.subResource=function(t,e,r){return this.buildResource(t._racksmeta.product,t._racksmeta.name+"/"+r,{_racksmeta:{resourceString:r,name:r,target:function(){return function(){return t._racksmeta.target()+"/"+e+"/"+r}}(this)}})},t.prototype.buildResource=function(t,e,r){var n,a;return a=null!=r?r:this[t][e],null==a._racksmeta&&(a._racksmeta={}),null==a._racksmeta.name&&(a._racksmeta.name=e),null==a._racksmeta.singular&&(a._racksmeta.singular="s"===a._racksmeta.name.substr(-1)?a._racksmeta.name.substr(0,a._racksmeta.name.length-1):a._racksmeta.name),a._racksmeta.product=t,n=this,null==a._racksmeta.target&&(a._racksmeta.target=function(){var e;return e=null!=a._racksmeta.resourceString?a._racksmeta.resourceString:this.name,n[t]._racksmeta.target()+e}),a._racksmeta.noResource||(a.all=function(t){return function(e){return t.resourceRequest(a,e)}}(this),a.assume=function(t){return function(e){return"string"==typeof e&&(e={id:e}),null==e.id&&null==e.name?t.log("[INFO] .assume() relies on .target() which in turn requires the object argument to have a .id or .name - please define one or the other - alternatively you can pass a string, in which case skinny will assume youre providing an id"):t.buildModel(a,e)}}(this),a["new"]=function(){return function(t,e){var r,s;return r={},r[a._racksmeta.singular]=t,s=null!=a._racksmeta.replyString?a._racksmeta.replyString:a._racksmeta.name,n.post(a._racksmeta.target(),r,function(r){if(null!=r[s])t=r[s];else{if(null==r[a._racksmeta.singular])return e(r);t=r[a._racksmeta.singular]}return null!=e?e(n.buildModel(a,t)):void 0})}}(this)),a},t.prototype.buildCatalog=function(t){var e;return e=this,t.forEach(function(t){return function(r){var n,a,s,u;if(null==r.name)return!1;if(null!=t[r.name]){t[r.name]._racksmeta={endpoints:r.endpoints,target:function(){var t,r;return r=!1,t=null!=e.datacenter?e.datacenter:e.access.user["RAX-AUTH:defaultRegion"],this.endpoints.length>1?this.endpoints.forEach(function(){return function(n){return n.region===t?r=n[e.network.toLowerCase()+"URL"]:void 0}}(this)):r=this.endpoints[0],"object"==typeof r&&(r=r[e.network.toLowerCase()+"URL"]),e.test&&(r="https://mockapi.com"),"/"!==r.substr(-1)&&(r+="/"),r}},t.products[r.name]={},s=t[r.name],u=[];for(a in s)n=s[a],t[r.name].hasOwnProperty(a)&&"_racksmeta"!==a?(t[r.name][a]=t.buildResource(r.name,a),u.push(t.products[r.name][a]=t[r.name][a])):u.push(void 0);return u}return t.log('no product named "'+r.name+'" found in racksjs - please contact the maintainers')}}(this))},t.prototype.mockApi=function(t,e){var r,n,a,s,u,i,o;if(a=[{id:1,_racksmeta:{name:"cloudServersOpenStack"}},{id:2,_racksmeta:{name:"cloudServersOpenStack"}}],null==t.data)return e(a);if(t.data.match(/apiKeyCredentials/)){for(n=["http://some-fake-testing-url.com",0,1,2],r={access:{user:{"RAX-AUTH:defaultRegion":"ORD"},token:{id:"some-fake-testing-id"},serviceCatalog:[]}},o=["cloudServersOpenStack","cloudServers","cloudLoadBalancers","cloudFilesCDN","cloudFiles","cloudBlockStorage","cloudDatabases","cloudBackup","cloudDNS","cloudImages","cloudMonitoring"],u=0,i=o.length;i>u;u++)s=o[u],r.access.serviceCatalog.push({name:s,endpoints:n});return e(r)}return e(a)},t.prototype.buildProducts=function(){var t;return t=this,this.cloudServersOpenStack={networks:{_racksmeta:{resourceString:"os-networksv2"},model:function(e){return e.show=function(r){var n;return"public"===(n=e.label)||"private"===n?r({network:{id:e.id,label:e.label,cidr:void 0}}):t.get(this._racksmeta.target(),r)},e["delete"]=function(e){return t["delete"](this._racksmeta.target(),e)},e}},flavors:{model:function(e){return e.details=function(e){return t.get(this._racksmeta.target(),e)},e.specs=function(e){return t.get(this._racksmeta.target()+"/os-extra_specs",e)},e}},images:{model:function(e){return e.details=function(e){return t.get(this._racksmeta.target(),e)},e["delete"]=function(e){return t["delete"](this._racksmeta.target(),e)},e}},servers:{_racksmeta:{requiredFields:{name:"string",imageRef:"string",flavorRef:"string"}},model:function(e){return e.systemActive=function(t,r){var n,a;return"function"==typeof t&&(r=t,t=15e3),n=function(){return function(){return e.details(function(t){return"ACTIVE"!==t.status?a():r(t)})}}(this),(a=function(){return function(){return setTimeout(n,t)}}(this))()},e.details=function(e){return t.get(this._racksmeta.target(),function(t){return e(t.server)})},e.addresses=function(e){return t.get(this._racksmeta.target()+"/ips",e)},e["delete"]=function(e){return t["delete"](this._racksmeta.target(),e)},e.update=function(e,r){return null==e.server&&(e={server:e}),t.put(this._racksmeta.target(),e,r)},e.action=function(e,r){return t.post(this._racksmeta.target()+"/action",e,r)},e.changePassword=function(t,r){return e.action({changePassword:{adminPass:t}},r)},e.reboot=function(t,r){var n;return"function"==typeof t&&(n=t,t="SOFT"),e.action({reboot:{type:t}},r)},e.rescue=function(t){return e.action({rescue:null},t)},e.unrescue=function(t){return e.action({unrescue:null},t)},e.createImage=function(t,r){return"string"==typeof t&&(t={createImage:{name:t}}),e.action(t,r)},e.serverActions=function(e){return t.get(this._racksmeta.target()+"/os-instance-actions",e)},e.showServerAction=function(e,r){return t.get(this._racksmeta.target()+"/os-instance-actions/"+e,r)},e.resize=function(t,r){return"string"==typeof t&&(t={flavorRef:t}),e.action({resize:t},r)},e.confirmResize=function(t){return e.action({confirmResize:null},t)},e.revertResize=function(t){return e.action({revertResize:null},t)},e.rebuild=function(t,r){return e.action({rebuild:t},r)},e.attachVolume=function(e,r){return t.post(this._racksmeta.target()+"/os-volume_attachments",e,r)},e.volumes=function(e){return t.get(this._racksmeta.target()+"/os-volume_attachments",e)},e.volumeDetails=function(e,r){return t.get(this._racksmeta.target()+"/os-volume_attachments/"+e,r)},e.detachVolume=function(e){return t["delete"](this._racksmeta.target()+"/os-volume_attachments/"+id,e)},e.metadata=function(e){return t.get(this._racksmeta.target()+"/metadata",e)},e.setMetadata=function(e,r){return null==e.metadata&&(e={metadata:e}),null==r&&(r=function(){return!1}),t.put(this._racksmeta.target()+"/metadata",e,r)},e.updateMetadata=function(e,r){return null==e.metadata&&(e={metadata:e}),t.post(this._racksmeta.target()+"/metadata",e,r)},e.getMetadataItem=function(e,r){return t.get(this._racksmeta.target()+"/metadata/"+e,r)},e.setMetadataItem=function(e,r,n){return null==r.metadata&&(r={metadata:r}),t.put(this._racksmeta.target()+"/metadata/"+e,r,n)},e.deleteMetadataItem=function(e,r){return t["delete"](this._racksmeta.target()+"/metadata/"+e,r)},e.getVips=function(e){return t.get(this._racksmeta.target()+"/os-virtual-interfacesv2",e)},e.attachNetwork=function(e,r){return null==e.metadata&&(e={virtual_interface:e}),t.post(this._racksmeta.target()+"/os-virtual-interfacesv2",e,r)},e}},keys:{_racksmeta:{resourceString:"os-keypairs"},model:function(e){return e["delete"]=function(e){return t["delete"](this._racksmeta.target(),e)},e.details=function(e){return t.get(this._racksmeta.target(),function(t){return e(t)})},e}}},this.cloudServers={servers:{model:function(t){return t}},images:{model:function(t){return t}},flavors:{model:function(t){return t}}},this.cloudLoadBalancers={algorithms:{model:function(t){return t}},alloweddomains:{model:function(t){return t}},protocols:{model:function(t){return t}},loadBalancers:{_racksmeta:{resourceString:"loadbalancers"},model:function(e){return e.details=function(e){return t.get(this._racksmeta.target(),function(t){return e(t.server)})},e}}},this.cloudFilesCDN={containers:{_racksmeta:{resourceString:"",plaintext:!0},model:function(t){var e;return e={name:t,_racksmeta:{name:t}}}}},this.cloudFiles={containers:{_racksmeta:{resourceString:"",plaintext:!0},model:function(t){var e;return e={name:t,_racksmeta:{name:t}}}}},this.autoscale={groups:{model:function(t){return t}}},this.cloudBlockStorage={volumes:{model:function(e){return e.details=function(e){return t.get(this._racksmeta.target(),e)},e["delete"]=function(e){return t["delete"](this._racksmeta.target(),e)},e.rename=function(e,r){return"string"==typeof e&&(e={name:e}),null==e.volume&&(e={volume:e}),t.put(this._racksmeta.target(),e,r)},e.snapshot=function(r,n){return"string"==typeof r&&(r={snapshot:{display_name:r}}),r.snapshot.volume_id=e.id,t.post(this.cloudBlockStorage._racksmeta.target()+"/snapshots",r,n)},e}},volumeDetails:function(e){return t.get(this._racksmeta.target()+"/volumes/detail",e)},types:{model:function(t){return t}},snapshots:{model:function(t){return t}},snapshotDetails:function(e){return t.get(this._racksmeta.target()+"/snapshots/detail",e)}},this.cloudDatabases={instances:{model:function(t){return t}}},this.cloudOrchestration={},this.cloudQueues={queues:{model:function(t){return t}}},this.cloudBackup={configurations:{model:function(t){return t}},agents:{model:function(t){return t}}},this.cloudDNS={limits:{model:function(t){return t}},domains:{_racksmeta:{singular:"domains"},model:function(t){return t}},rdns:{model:function(t){return t}}},this.cloudImages={},this.cloudMonitoring={entities:{model:function(t){return t}},audits:{model:function(t){return t}},checkTypes:{model:function(t){return t}},monitoringZones:{model:function(t){return t}},notifications:{model:function(t){return t}},agents:{model:function(t){return t}},notification_plans:{model:function(t){return t}},overview:function(e){return t.get(this._racksmeta.target()+"/views/overview",e)},account:function(e){return t.get(this._racksmeta.target()+"/account",e)},updateAccount:function(e,r){return t.put(this._racksmeta.target()+"/account",e,r)},limits:function(e){return t.get(this._racksmeta.target()+"/limits",e)},usage:function(e){return t.get(this._racksmeta.target()+"/usage",e)},changelogs:function(e){return t.get(this._racksmeta.target()+"/changelogs/alarms",e)}},this.servers=this.cloudServersOpenStack.servers,this.networks=this.cloudServersOpenStack.networks,this.ngservers=this.cloudServersOpenStack.servers,this.nextgen=this.cloudServersOpenStack,this.fgservers=this.cloudServers.servers,this.firstgen=this.cloudServers,this.clbs=this.cloudLoadBalancers.loadBalancers},t}()}).call(this);